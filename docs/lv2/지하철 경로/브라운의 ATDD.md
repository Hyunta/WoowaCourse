## ATDD Intro

ATDD 인수테스트 주도개발 -> 아마 고민을 했던 부분이지 않을까



### ATDD 이야기를 하기 전에

```
인수테스트가 무엇인지

인스테스트 주도 개발이 무엇이고 왜 하는지

TDD를 조금 더 잘하기 위해 인수 테스트를 어떻게 활용하는지
```



레벨 2에서는 TDD를 하려고 하는데 잘 안되네...

웹 애플리케이션에서 잘하기 위해서 인수테스트를 활용할 것이다.



### ATDD는 모든 문제를 해결할 수 없다.

개발 방법론, 프로세스는 필요한 상황에 적재적소에 사용하면 좋은 도구가 될 것이다.

요구사항을 잘못 이해한적 있나요? -> 올바른 요구사항을 가리키는 등대가 있었다면?!



### ATDD를 통해 효율적인 개발 프로세스를 경험하세요

`테스트가 가능한 요구사항`으로 소프트웨어를 개발하는 프로세스

```
TDD - `작은 단위`의 요구 사항

ATDD -` 시나리오 형태`의 요구 사항 / 인수 or 수용 테스트
```

둘은 비슷한 개념이지만 다른 개념이다.



### ATDD를 하는 이유

> 구현전에 인수 테스트를 수행하는 경우 팀의 생산성이 두 배가 되는 것을 확인 - 제프 서덜랜드(스크럼 공동 제작자)

#### 장점:

```
1.명확한 요구사항이 생산성을 증대시킨다
2.작업의 명확한 시작과 끝을 제시
3.input과 output에 대해서 프로세스를 진행하면 문제없이 실행될 것이다.
4.빠른 피드백
5.귀찮은 작업을 프로세스로 강제
```



## 인수 테스트란?

![image-20220520105546348](/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520105546348.png)

- 사용자 스토리를 검증하는 기능 테스트



### 테스트 종류

- 단위 테스트 -> 단위를 검증한다 / 그럼 단위는 무엇인가?
- 통합 테스트 -> 단위가 통합이 잘 되어있는가?
- E2E 테스트 -> 엔드포인트에 대한 테스트

명세나 계약의 **요구 사항이 충족되는지 확인**하기 위해 수행되는 테스트



### Acceptance? 인수?

- 수락, 받아들임이라는 뜻
- 작업을 종료 시켜도 되는지 검증하는 테스트
- 이 테스트가 성공하면 작업 끝!

그 동안 만들어본 테스트와 인수테스트는 뭐가 다를까?



#### 사용자 스토리 기반으로 시나리오를 작성한다.

```
<정상적인 시나리오>
10000원을 입력한다.
10장의 로또가 구매한다
10장의 로또 번호가 출력된다
지난주 당첨번호로 입력한다
당첨 통계가 출력한다
수익률이 출력된다

<비정상적인 시나리오>
100원을 입력한다.
로또를 구입할 수 없다.
```



### API 개발을 위한 시나리오 기반 인수테스트 만들기

```
지하철 역 생성
	지하철 역 생성 요청을 한다.
	지하철 역이 생성되었다.

지하철 역 조회
	지하철 역 조회를 요청한다.
	지하철 역을 보여준다.
```

인수테스트는 API 테스트?

인수테스트는 E2E 테스트?

인수테스트는 테스트 의도에 따라서 달라진다.



E2E 테스트 는 request와 response에 대해 검증하는 테스트

시나리오를 검증하는게 인수테스트지만, API 명세를 검증하는 것도 비슷하다고 생각한다.



### 인수 테스트 만들기 전 알아야 할 것

전체적인 시나리오를 검증하는게 인수테스트 - 여러 요청이 엮이는 경우가 있다.

요청에 대한 테스트를 하는게 컨트롤러 테스트



### 인수 테스트를 만들 때 어떻게 만들 수 있을까?

블랙 박스 테스트 - 내부 코드를 모르는 테스트 / 들어가고 나오는 것만 안다/ 내부 구현에는 관심이 없다.

- 표면적으로 확인할 수 있는 요소를 바탕으로 검증하려함
- 실제 사용하는 상황의 시나리오를 바탕으로 요구사항을 검증

E2E 테스트 - API 레벨의 블랙박스 테스트, RestAssured를 통해서 결과를 검증한다.

```
SpringBootTest - ApplicationContext를 쉽게 지정하게 도와줌, @ContextConfiguration의 발전된 기능
webEnvironment 속성을 사용하여 테스트 서버의 실행 방법을 설정- RANDOM_PORT: 실제 웹 환경을 구현
```

테스트 객체를 선택하는데

MockMvc vs WebTestClient vs RestAssured

어떤 장단점이 있는지, 정리해서 공부해주세요



JsonPath 라는 도구를 통해 사용할 수 있다.

json 문서를 읽는 방법을 제공한다.

---

### 인수 테스트 격리

Context Caching - 모든 테스트는 격리되어있어야 한다.

DatabaseCleanUp - EntityManager를 활용하여 테이블 이름 조회후 각 테이블 Truncate 실행



### 인수 테스트 주도 개발

인수 테스트는 고객과 개발자, 그리고 테스터간의 커뮤니케이션을 기반으로한 개발 방법론이다.

이러한 프로세스는 개발자와 테스터가 구현 전에 고객의 요구를...



### 인수 테스트 주도로 개발은 어떻게 하나요?

ATDD에 TDD가 포함인가요?

```
포비 - ATDD에 TDD 사이클이 포함된다
브라운 - ATDD는 시나리오 기반의 테스트 개발 방법론, TDD가 시너지를 낼 수 있는 관계다
```



인수 조건형식

- 시나리오 기반 (given/ when/ then 형식)
- 규칙 기반
- 커스텀 포맷

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520113157598.png" alt="image-20220520113157598" style="zoom: 50%;" />

주객이 전도되면 안된다... 학습할 때는 해보는게 좋다.



### 인수 테스트 기반 TDD

컨트롤러 테스트 vs 인수 테스트

컨트롤러 테스트 - 하나의 요청과 응답을 받는 테스트

인수 테스트 - 여러개의 요청이 올 수도 있다.



TopDown으로 개발할 것인가 도메인부터 개발해서 올라갈 것인가?

### 인수 테스트 기반 TDD 소개

TDD가 어려운 이유 ? 규칙은 간단하지만 잘하고 있는지 잘 모르겠음... TDD에서 말하는 대부분이 추상적임

인수 테스트에서 TDD사이클로 넘어가는 흐름

- 단위 테스트 종류 알아보기
- TDD 흐름의 종류 알아보기



### 단위 테스트 - 협력 객체에 따른 구분

프로덕션 코드의 작은 단위에 대한 테스트

작은 코드 조각을 검증, 빠르게 수행 가능, 격리된 방식으로 처리

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520114411701.png" alt="image-20220520114411701" style="zoom:50%;" />



협력 객체가 있는 단위테스트를 만들 때 어려움을 겪는다,

협력 객체를 실제 객체로 사용하는지 Mock 객체로 사용하는지에 따라 테스트 구현이 달라짐



### Test Double

실제 객체 대신 사용되는 모든 종류의 객체에 대한 일반 용어

실제를 가짜 버전으로 대체한다는 이유

Stub 객체 : 메서드 호출을 했을 때 응답할 것을 미리 정해두는 것이 Stub

스프링 컨테이너에 올라간 객체를 stub객체로 전달할 수 있다



협력 객체를 실제 객체로? 가짜 객체로?

### Classist vs Mockist

격리된 방식으로 처리 - 테스트 대상과 협력 객체 간의 격리! vs 테스트와 테스트 간의 격리!

c : 격리는 테스트끼리 격리하는 것이다

m: 테스트 대상과 협력 객체 간의 격리가 필요하기 때문에 / 협력 객체를 전부 목으로 주입



outsideIn TDD : 

도메인에 대한 이해도가 높지 않은 상태에서 진행이 가능, 

상대적으로 프로덕션 코드에 의존적인 테스트가 작성됨



insideOut TDD  : 

도메인 설계가 충분히 이루어진 다음에 진행가능하다.

 방향을 잃어버리기 쉽다. 시나리오를 도메인 요구사항으로 보기 쉽지 않다.



---

TDD를 연습할 때 가급적이면 실제 객체를 활용하는것을 추천

둘 중 하나를 선택해야 하는 문제가 아님



> 상향식, 하향식 모르겠는데 아는것에서 모르는 것으로 방향을 가지는게 좋다 켄트백

추천 방법

- Top Down으로 방향을 잡고 / Bottom-up으로 구현하기
- 인수 테스트 작성을 통해 요구사항과 기능 전반에 대한 이해를 선행
- 내부 구현에 대한 설계 흐릉을 구상
- 설계가 끝나면 도메인부터 차근차근 TDD로 기능 구현
- 만약 도메인이 복잡하거나 설계가 어려울 경우 이해하고 있는 부분부터 기능 구현



<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520121235542.png" alt="image-20220520121235542" style="zoom:50%;" />

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520121356768.png" alt="image-20220520121356768" style="zoom:50%;" />

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520121419297.png" alt="image-20220520121419297" style="zoom:50%;" />

<img src="/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220520121434486.png" alt="image-20220520121434486" style="zoom:50%;" />
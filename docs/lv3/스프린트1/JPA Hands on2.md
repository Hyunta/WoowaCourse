# ğŸ“– JPA Hands-on Part 2

# ë“¤ì–´ê°€ê¸° ì „ì—

- ê°ì²´ëŠ” íŒŒìŠ¤ì¹¼ í‘œê¸°ë²•ì„ ë”°ë¥¸ë‹¤.
  - `Line`, `Station`, `Member`, `Favorite`, `LineStation`
- í…Œì´ë¸”ì€ ìŠ¤ë„¤ì´í¬ í‘œê¸°ë²•ì„ ë”°ë¥¸ë‹¤.
  - `line`, `station`, `member`, `favorite`, `line_station`

# ì—°ê´€ ê´€ê³„

- ì—”í‹°í‹°ë“¤ì€ ëŒ€ë¶€ë¶„ ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ ê´€ê³„ê°€ ìˆë‹¤.
- ê°ì²´ëŠ” ì°¸ì¡°(ì£¼ì†Œ)ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ê³„ë¥¼ ë§ºê³  í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

## í•µì‹¬ í‚¤ì›Œë“œ

- ë°©í–¥: ë‹¨ë°©í–¥, ì–‘ë°©í–¥ì´ ìˆë‹¤.ë°©í–¥ì€ ê°ì²´ ê´€ê³„ì—ë§Œ ì¡´ì¬í•˜ê³  í…Œì´ë¸” ê´€ê³„ëŠ” í•­ìƒ ì–‘ë°©í–¥ì´ë‹¤.
- ë‹¤ì¤‘ì„±: ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1), ë‹¤ëŒ€ë‹¤(N:M)
- ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸: ê°ì²´ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ë¡œ ë§Œë“¤ë©´ ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ í•œë‹¤.

## ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤ ì—°ê´€ ê´€ê³„

- ì—­ê³¼ ë…¸ì„ ì´ ìˆë‹¤.
- ì§€í•˜ì² ì—­ì€ í•˜ë‚˜ì˜ ë…¸ì„ ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
  - **í™˜ìŠ¹ì—­ì€ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤.**
- **ì§€í•˜ì² ì—­ê³¼ ë…¸ì„ ì€ ë‹¤ëŒ€ì¼(N:1) ê´€ê³„ë‹¤.**
- **ë…¸ì„ ê³¼ ì§€í•˜ì² ì—­ì€ ì¼ëŒ€ë‹¤(1:N) ê´€ê³„ë‹¤.**

```java
class Line {
    Long id;
    String name;
}

class Station {
    Long id;
    String name;
}
```

## ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„

```java
@Entity
@Table(name = "line")
public class Line {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;
    
    ...

}
@Entity
@Table(name = "station")
public class Station {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;
    
    @ManyToOne // (1)
    @JoinColumn(name = "line_id") // (2)
    private Line line; // (3)
    
    public void setLine(final Line line) { // (4)
        this.line = line;
    }
    
    ...

}
```

1. ```
   @ManyToOne
   ```

   - ë‹¤ëŒ€ì¼(N:1) ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´

2. ```
   @JoinColumn
   ```

   - ì»¬ëŸ¼ ì´ë¦„ê³¼ ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•  ì»¬ëŸ¼ì„ ì§ì ‘ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ êµ³ì´ ì„ ì–¸í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

3. ì§€í•˜ì² ì—­ ê°ì²´ëŠ”

    

   ```
   line
   ```

    

   í•„ë“œë¡œ ë…¸ì„  ê°ì²´ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

   - **`Station` -> `Line`: ê°€ëŠ¥**
   - **`Line` -> `Station`: ë¶ˆê°€ëŠ¥**
   - `station` -> `line`: ê°€ëŠ¥
   - `line` -> `station`: ê°€ëŠ¥
   - **ì§€í•˜ì² ì—­ê³¼ ë…¸ì„ ì€ ë‹¨ë°©í–¥ ê´€ê³„ë‹¤.**

4. ì—°ê´€ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì„œë“œ

## ì‹¤ìŠµ

- ì½˜ì†”ì— ì‹¤í–‰ë˜ëŠ” í…Œì´ë¸” ìƒì„± DDLì„ ì¶œë ¥í•´ ë³´ì.

```sql
create table line (
    id bigint generated by default as identity,
    name varchar(255) not null,
    primary key (id)
)

create table station (
    id bigint generated by default as identity,
    name varchar(255) not null,
    line_id bigint,
    primary key (id)
)

alter table station 
    add constraint FKklalypfiiahjy57wtapf4w92 
    foreign key (line_id) 
    references line
```

## ì‹¤ìŠµ

- ì—°ê´€ ê´€ê³„ë¥¼ ì„¤ì •í•œ í›„ ì €ì¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void saveWithLine() {
    Station expected = new Station("ì ì‹¤ì—­");
    expected.setLine(new Line("2í˜¸ì„ "));
    Station actual = stations.save(expected);
    stations.flush(); // transaction commit
}
insert 
into
    station
    (id, line_id, name) 
values
    (null, null, 'ì ì‹¤ì—­')
```



JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ì—°ê´€ëœ ëª¨ë“  ì—”í‹°í‹°ëŠ” ì˜ì† ìƒíƒœì—¬ì•¼ í•œë‹¤.

```java
@Test
void saveWithLine() {
    Station expected = new Station("ì ì‹¤ì—­");
    expected.setLine(lines.save(new Line("2í˜¸ì„ ")));
    Station actual = stations.save(expected);
    stations.flush(); // transaction commit
}
insert 
into
    line
    (id, name) 
values
    (null, '2í˜¸ì„ ')
    
insert 
into
    station
    (id, line_id, name) 
values
    (null, 1, 'ì ì‹¤ì—­')
```

## ì‹¤ìŠµ

- ì¡°íšŒì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.
- `data.sql`

```sql
INSERT INTO line (id, name) VALUES (1, '3í˜¸ì„ ')
INSERT INTO station (id, line_id, name) VALUES (1, 1, 'êµëŒ€ì—­')
@Test
void findByNameWithLine() {
    Station actual = stations.findByName("êµëŒ€ì—­");
    assertThat(actual).isNotNull();
    assertThat(actual.getLine().getName()).isEqualTo("3í˜¸ì„ ");
}
select
    station0_.id as id1_1_,
    station0_.line_id as line_id3_1_,
    station0_.name as name2_1_ 
from
    station station0_ 
where
    station0_.name='êµëŒ€ì—­'
    
select
    line0_.id as id1_0_0_,
    line0_.name as name2_0_0_ 
from
    line line0_ 
where
    line0_.id=1
```

## ì‹¤ìŠµ

- ìˆ˜ì •ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void updateWithLine() {
    Station expected = stations.findByName("êµëŒ€ì—­");
    expected.setLine(lines.save(new Line("2í˜¸ì„ ")));
    stations.flush(); // transaction commit
}
update
    station 
set
    line_id=2,
    name='êµëŒ€ì—­'
where
    id=1
```

## ì‹¤ìŠµ

- ì—°ê´€ ê´€ê³„ ì œê±°ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void removeLine() {
    Station expected = stations.findByName("êµëŒ€ì—­");
    expected.setLine(null);
    stations.flush(); // transaction commit
}
update
    station 
set
    line_id=null,
    name='êµëŒ€ì—­'
where
    id=1
```



ë…¸ì„ ì„ ì‚­ì œí•˜ë ¤ë©´ ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•œë‹¤.

## ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„

- ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
@Entity
@Table(name = "line")
public class Line {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;

    @OneToMany(mappedBy = "line") // (1)
    private List<Station> stations = new ArrayList<>(); // (2)
    
    ...

}
```

1. ```
   @OneToMany
   ```

   - ì¼ëŒ€ë‹¤(1:N) ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´
   - `mappedBy` ì†ì„±ì€ ì—°ê´€ ê´€ê³„ ì£¼ì¸ì˜ í•„ë“œ ì´ë¦„

2. ë…¸ì„  ê°ì²´ëŠ”

    

   ```
   stations
   ```

    

   í•„ë“œë¡œ ì§€í•˜ì² ì—­ ê°ì²´ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

   - **`Station` -> `Line`: ê°€ëŠ¥**
   - **`Line` -> `Station`: ê°€ëŠ¥**
   - `station` -> `line`: ê°€ëŠ¥
   - `line` -> `station`: ê°€ëŠ¥
   - **ì§€í•˜ì² ì—­ê³¼ ë…¸ì„ ì€ ì–‘ë°©í–¥ ê´€ê³„ë‹¤.**

## ì‹¤ìŠµ

- ì¡°íšŒì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void findById() {
    Line line = lines.findByName("3í˜¸ì„ ");
    assertThat(line.getStations()).hasSize(1);
}
select
    line0_.id as id1_0_,
    line0_.name as name2_0_ 
from
    line line0_ 
where
    line0_.name='3í˜¸ì„ '

select
    stations0_.line_id as line_id3_1_0_,
    stations0_.id as id1_1_0_,
    stations0_.id as id1_1_1_,
    stations0_.line_id as line_id3_1_1_,
    stations0_.name as name2_1_1_ 
from
    station stations0_ 
where
    stations0_.line_id=1
```

## ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸

- ì—„ë°€íˆ ì´ì•¼ê¸°í•˜ë©´ ê°ì²´ì—ëŠ” ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ë¼ëŠ” ê²ƒì´ ì—†ë‹¤.
- ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„ 2ê°œë¥¼ ì–‘ë°©í–¥ì¸ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•  ë¿ì´ë‹¤.
  - **ì§€í•˜ì² ì—­ê³¼ ë…¸ì„ ì€ ë‹¤ëŒ€ì¼(N:1) ê´€ê³„ë‹¤.**
  - **ë…¸ì„ ê³¼ ì§€í•˜ì² ì—­ì€ ì¼ëŒ€ë‹¤(1:N) ê´€ê³„ë‹¤.**
- **ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ë“±ë¡, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆë‹¤.**
- **ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ í•  ìˆ˜ ìˆë‹¤.**



ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•œë‹¤ëŠ” ê²ƒì€ ì™¸ë˜ í‚¤ ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ìš”ë„ë¡œ ì ‘ê·¼í•˜ë©´ ì•ˆ ëœë‹¤.



ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œëŠ” í•­ìƒ ë‹¤ ìª½ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ë‹¤.

## ì‹¤ìŠµ

- ì €ì¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void save() {
    Line expected = new Line("2í˜¸ì„ ");
    expected.addStation(new Station("ì ì‹¤ì—­"));
    lines.save(expected);
    lines.flush(); // transaction commit
}
insert 
into
    line
    (id, name) 
values
    (null, '2í˜¸ì„ ')
@Test
void save() {
    Line expected = new Line("2í˜¸ì„ ");
    expected.addStation(stations.save(new Station("ì ì‹¤ì—­")));
    lines.save(expected);
    lines.flush(); // transaction commit
}
insert 
into
    station
    (id, line_id, name) 
values
    (null, null, 'ì ì‹¤ì—­')

insert 
into
    line
    (id, name) 
values
    (null, '2í˜¸ì„ ')
```



ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì— ì…ë ¥ëœ ê°’ì€ ì™¸ë˜ í‚¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

## ì—°ê´€ ê´€ê³„ í¸ì˜ ë©”ì„œë“œ

- ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ëŠ” ê²°êµ­ ì–‘ìª½ ë‹¤ ì‹ ê²½ ì¨ì•¼ í•œë‹¤.

```java
station.setLine(line);
line.addStation(station);
```

- ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ë‘ ì½”ë“œëŠ” í•˜ë‚˜ì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.
- í•œ ë²ˆì— ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì„œë“œë¥¼ **ì—°ê´€ ê´€ê³„ í¸ì˜ ë©”ì„œë“œ**ë¼ í•œë‹¤.

```java
public void setLine(Line line) {
    this.line = line;
    line.getStations().add(this);
}
public void addStation(Station station) {
    stations.add(station);
    station.setLine(this);
}
```



ì–‘ë°©í–¥ ë§¤í•‘ ì‹œì—ëŠ” ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ì§€ ì•Šê²Œ ì¡°ì‹¬í•´ì•¼ í•œë‹¤.

## ì—°ê´€ ê´€ê³„ í¸ì˜ ë©”ì„œë“œ ì‘ì„± ì‹œ ì£¼ì˜ ì‚¬í•­

```java
station.setLine(line1);
station.setLine(line2);
boolean contains = line1.getStations().contains(station); // true
public void setLine(Line line) {
    if (Objects.nonNull(this.line) {
        this.line.getStations().remove(this);
    }
    this.line = line;
    line.getStations().add(this);
}
```

## ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„

```java
@Entity
public class Favorite {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    protected Favorite() {
    }
}
@Entity
public class Member {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany // (1)
    @JoinColumn(name = "member_id") // (2)
    private List<Favorite> favorites = new ArrayList<>(); // (3)

    ...

}
```

1. ```
   @OneToMany
   ```

   - ì¼ëŒ€ë‹¤(1:N) ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´

2. ```
   @JoinColumn
   ```

   - **`favorite`ì˜ ì™¸ë˜ í‚¤**

3. ì‚¬ìš©ì ê°ì²´ëŠ”

    

   ```
   favorites
   ```

    

   í•„ë“œë¡œ ì§€í•˜ì² ì—­ ê°ì²´ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

   - **`Member` -> `Favorite`: ê°€ëŠ¥**
   - **`Favorite` -> `Member`: ë¶ˆê°€ëŠ¥**
   - `member` -> `favorite`: ê°€ëŠ¥
   - `favorite` -> `member`: ê°€ëŠ¥
   - **ì‚¬ìš©ìì™€ ì¦ê²¨ì°¾ê¸°ëŠ” ë‹¨ë°©í–¥ ê´€ê³„ë‹¤.**

## ì‹¤ìŠµ

- ì½˜ì†”ì— ì‹¤í–‰ë˜ëŠ” í…Œì´ë¸” ìƒì„± DDLì„ ì¶œë ¥í•´ ë³´ì.

```sql
create table favorite (
    id bigint generated by default as identity,
    member_id bigint,
    primary key (id)
)

create table member (
    id bigint generated by default as identity,
    name varchar(255),
    primary key (id)
)

alter table favorite 
   add constraint FK5w3q9ljpthkixo71hetx3ired 
   foreign key (member_id) 
   references member
```

## ì‹¤ìŠµ

- ì €ì¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void save() {
    Member expected = new Member("jason");
    expected.addFavorite(favorites.save(new Favorite()));
    Member actual = members.save(expected);
    members.flush(); // transaction commit
}
insert 
into
    favorite
    (id) 
values
    (null)

insert 
into
    member
    (id, name) 
values
    (null, 'jason')

update
    favorite 
set
    member_id=1 
where
    id=1
```

## ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì˜ ë‹¨ì 

- ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆë‹¤.
- ì—°ê´€ ê´€ê³„ ì²˜ë¦¬ë¥¼ ìœ„í•œ UPDATE SQLì„ ì¶”ê°€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.
- **ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ê¶Œì¥í•œë‹¤.**

## ì¼ëŒ€ì¼ ì—°ê´€ ê´€ê³„

- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ê·¸ ë°˜ëŒ€ë„ ì¼ëŒ€ì¼ ê´€ê³„ë‹¤.

- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ì£¼ í…Œì´ë¸”ì´ë‚˜ ëŒ€ìƒ í…Œì´ë¸” ë‘˜ ì¤‘ ì–´ëŠ ê³³ì´ë‚˜ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—

   

  ì™¸ë˜ í‚¤ë¥¼ ì–´ëŠ ê³³ì— ë‘ì–´ì•¼ í•˜ëŠ”ì§€ ê³ ë¯¼ì„ í•´ì•¼ í•œë‹¤.

  - `station`ì´ ì£¼ í…Œì´ë¸”ì´ê³  `line_station`ì´ ëŒ€ìƒ í…Œì´ë¸”ì´ë¼ê³  ê°€ì •í•œë‹¤.

```java
class Station {
    Long id;
    String name;
    LineStation lineStation;
}

class LineStation {
    Long id;
}
```

## ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

- ì£¼ í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ ì£¼ í…Œì´ë¸”ë§Œ í™•ì¸í•´ë„ ëŒ€ìƒ í…Œì´ë¸”ê³¼ ì—°ê´€ ê´€ê³„ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.
  - **`Station` -> `LineStation`: ê°€ëŠ¥**

### ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„

```java
@Entity
@Table(name = "line_station")
public class LineStation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "line_id")
    private Line line;
    
    ...

}
@Entity
@Table(name = "station")
public class Station {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", nullable = false)
    private String name;

    @OneToOne // (1)
    @JoinColumn(name = "line_station_id") // (2)
    private LineStation lineStation; // (3)
    
    ...

}
```

1. ```
   @OneToOne
   ```

   - ì¼ëŒ€ì¼(1:1) ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´

2. ```
   @JoinColumn
   ```

   - ì»¬ëŸ¼ ì´ë¦„ê³¼ ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•  ì»¬ëŸ¼ì„ ì§ì ‘ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ êµ³ì´ ì„ ì–¸í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

3. ì§€í•˜ì² ì—­ ê°ì²´ëŠ”

    

   ```
   lineStation
   ```

    

   í•„ë“œë¡œ ë…¸ì„ ì˜ ì§€í•˜ì² ì—­ ê°ì²´ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

   - **`Station` -> `LineStation`: ê°€ëŠ¥**
   - **`LineStation` -> `Station`: ë¶ˆê°€ëŠ¥**
   - `station` -> `line_station`: ê°€ëŠ¥
   - `liline_stationne` -> `station`: ê°€ëŠ¥

## ì‹¤ìŠµ

- ì½˜ì†”ì— ì‹¤í–‰ë˜ëŠ” í…Œì´ë¸” ìƒì„± DDLì„ ì¶œë ¥í•´ ë³´ì.

```sql
create table line_station (
    id bigint generated by default as identity,
    line_id bigint,
    primary key (id)
)

create table station (
    id bigint generated by default as identity,
    name varchar(255) not null,
    line_station_id bigint,
    primary key (id)
)

alter table station 
   add constraint FKtkxivxas996j9c54ngcd0bby2 
   foreign key (line_station_id) 
   references line_station
```

## ì‹¤ìŠµ

- ì €ì¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ì.

```java
@Test
void saveWithLineStation() {
    LineStation lineStation = lineStations.save(new LineStation());
    stations.save(new Station("ì ì‹¤ì—­", lineStation));
}
insert 
into
    line_station
    (id, line_id) 
values
    (null, 1)

insert 
into
    station
    (id, line_station_id, name) 
values
    (null, 1, 'ì ì‹¤ì—­')
```

### ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„

```java
@Entity
@Table(name = "line_station")
public class LineStation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "line_id")
    private Line line;
    
    @OneToOne(mappedBy = "lineStation") // (1)
    private Station station; // (2)
    
    ...

}
```

1. ```
   @OneToOne
   ```

   - ì¼ëŒ€ì¼(1:1) ê´€ê³„ë¼ëŠ” ë§¤í•‘ ì •ë³´
   - `mappedBy` ì†ì„±ì€ ì—°ê´€ ê´€ê³„ ì£¼ì¸ì˜ í•„ë“œ ì´ë¦„

2. ë…¸ì„ ì˜ ì§€í•˜ì² ì—­ ê°ì²´ëŠ”

    

   ```
   station
   ```

    

   í•„ë“œë¡œ ì§€í•˜ì² ì—­ ê°ì²´ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.

   - **`Station` -> `LineStation`: ê°€ëŠ¥**
   - **`LineStation` -> `Station`: ê°€ëŠ¥**
   - `station` -> `line_station`: ê°€ëŠ¥
   - `line_station` -> `station`: ê°€ëŠ¥

## ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤

- í…Œì´ë¸” ê´€ê³„ë¥¼ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ë¡œ ë³€ê²½í•  ë•Œ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.
  - **í™˜ìŠ¹ì—­ì„ ê³ ë ¤í•´ ë³¸ë‹¤.**

### ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„

- ì´ëŸ° ëª¨ì–‘ìœ¼ë¡œ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‹¤.
  - **`Station` -> `LineStation`: ë¶ˆê°€ëŠ¥**
  - **`LineStation` -> `Station`: ë¶ˆê°€ëŠ¥**

### ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„

```java
@Entity
@Table(name = "line_station")
public class LineStation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "line_id")
    private Line line;
    
    @OneToOne
    @JoinColumn(name = "station_id")
    private Station station;
    
    ...

}
@Entity
@Table(name = "station")
public class Station {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", nullable = false)
    private String name;

    @OneToOne(mappedBy = "station")
    private LineStation lineStation;
    
    ...

}
```

## ì‹¤ìŠµ

- ì½˜ì†”ì— ì‹¤í–‰ë˜ëŠ” í…Œì´ë¸” ìƒì„± DDLì„ ì¶œë ¥í•´ ë³´ì.

```sql
create table line_station (
    id bigint generated by default as identity,
    line_id bigint,
    station_id bigint,
    primary key (id)
)

create table station (
    id bigint generated by default as identity,
    name varchar(255) not null,
    primary key (id)
)

alter table line_station 
    add constraint FK78y8i0a0kum6n7s2qss4wi6i9 
    foreign key (station_id) 
    references station
```

## ë‹¤ëŒ€ë‹¤ ì—°ê´€ ê´€ê³„

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ê·œí™”ëœ í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.
- ë³´í†µ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ë‚´ëŠ” ì—°ê²° í…Œì´ë¸”ì„ ì‚¬ìš©í•œë‹¤.
- **ì—°ê²° í…Œì´ë¸”ì— í•„ë“œê°€ ì¶”ê°€ë˜ë©´ ë”ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.**

# ë” í•˜ê³  ì‹¶ì€ ë§

- ì§€ì—° ë¡œë”©
- CASCADE
- ê³ ì•„ ê°ì²´
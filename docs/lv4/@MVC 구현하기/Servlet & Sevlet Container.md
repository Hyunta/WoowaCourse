## Servlet 이란?

- 자바로 HTTP 요청을 처리하는 프로그램을 만들 때 서블릿을 사용한다.
- 서블릿은 자바 표준이다. Jakarta EE 스펙이다.



- 자바로 웹 서비스 개발할 때 스프링만 썼는데?
  - 스프링 MVC는 서블릿 기반으로 작동한다.
    - DispatcherServlet
    - Filter



- 서블릿만 써도 되는데 왜 스프링을 쓰는가?
  - J2EE 스펙이 사용하기 복잡해서 등장했다.
  - 서블릿을 활용한 J2EE만으로는 엔터프라이즈 애플리케이션을 운영하기 어렵다.



- 어차피 스프링으로 웹개발하는데 서블릿은 몰라도 되지 않나?
  - 서블릿 기반으로 스프링MVC가 동작하기 때문에 원리는 알아야 한다.



- 서블릿 표준에 맞춰 구현할 수 있도록 인터페이스가 제공된다.
- init(), service(), destroy() 메서드는 각각 무엇일까?



### 서블릿의 생명 주기

- init(), service(), destroy() 메서드를 라이프 사이클 메서드라고 부른다



웹 컨테이너 (톰캣) 이 실행이 될 때 서블릿 클래스를 로드한다. 불러온 파일을 가지고 서블릿 객체로 만들어준다. init으로 서블릿을 한번만 실행한다. 클라이언트의 요청을 받아서 처리해주는 역할을 한다. 서블릿의 service 메서드가 호출된다.



톰캣을 Servlet Container 혹은 WAS 라고 부른다. 요청을 처리해줄 적절한 서블릿을 찾는다. 예를 들어 로그인을 처리하는 서블릿을 가지고 객체를 만들어둔다. 로그아웃 처리하는 서블릿이 있다고 하자. 컨테이너가 한개씩만 만들어 둔다. 싱글톤은 아니고 톰캣이 실행될 때 서블릿이 한번만 실행되는거지 싱글톤은 아니다.



![image-20220915132506401](/Users/kimhyuntae/Library/Application Support/typora-user-images/image-20220915132506401.png)

http 요청을 가지고 request와 response를 만든다. 관리하고 있는 Servlet 중에서 해당 httpUrl에 맞춰서 적절한 객체를 찾고 service를 실행시킨다. 웹에서 여러처리를 동시에 하는 것은 서블릿은 하나지만 서블릿에서 여러 스레드가 처리하는 식으로 동작한다.

처리한 객체를 response 객체를 통해서 컨테이너에 반환하고 컨테이너는 클라이언트에 반환한다. 요청에 사용한 쓰레드는 반납한다.



### 서블릿 하나로 다수 요청을 처리한다.

웹서버, WAS 는 기본적으로 멀티 스레드로 처리한다. Servlet으로 웹서버를 구성할 때 상태를 만들면 안된다. 상태라 하믄 instance 변수, static 변수 들. 상태가 있으면 공유가 된다. 사용자 관련해서 노출하면 안되는 정보를 담고 있다면 큰 문제가 된다.



### Filter란

- 요청, 응답에 추가적인 작업을 하고 싶을 때 필터를 사용한다.
- 표준에 맞춰 구현할 수 있도록 인터페이스가 제공된다.
- 요청, 응답에 추가작업을 하고 싶다면 doFilter() 메서드를 구현하면 된다.
- 웹 서버 전반적으로 적용할만한 작업들을 넣는다.



Client -> Container -> (Filter) -> Servlet -> (Filter) -> Container -> Client





